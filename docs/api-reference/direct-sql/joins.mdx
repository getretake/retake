---
title: JOINs with Text Search
---

<Note>
  See the [overview](/api-reference/direct-sql/overview#getting-started) for
  creating the necessary example data
</Note>

To demonstrate joins with text search, we need more data. This table represents orders with a foreign key back to the
`id` column of `paradedb.bm25_search` (which represents products). We also populate this table with some data:

```sql
CREATE TABLE paradedb.orders (
    order_id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL,
    order_quantity INTEGER NOT NULL,
    order_total DECIMAL(10, 2) NOT NULL,
    order_date TIMESTAMP WITHOUT TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    customer_name VARCHAR(255) NOT NULL,
    delivery_address TEXT NOT NULL,
    FOREIGN KEY (product_id) REFERENCES paradedb.bm25_search(id)
);

CREATE INDEX idxorders_customer_name ON paradedb.orders(customer_name);

INSERT INTO paradedb.orders (product_id, order_quantity, order_total, customer_name, delivery_address)
VALUES
(1, 3, 99.99, 'John Doe', '123 Elm Street'),
(2, 1, 49.99, 'Jane Smith', '456 Oak Street'),
(3, 5, 249.95, 'Alice Johnson', '789 Pine Avenue'),
(4, 2, 89.98, 'Bob Brown', '321 Cedar Drive'),
(5, 4, 119.96, 'Charlie Williams', '654 Maple Lane'),
(6, 1, 39.99, 'Emily Davis', '987 Spruce Road'),
(7, 2, 79.98, 'David Miller', '135 Birch Boulevard'),
(8, 6, 179.94, 'Sophia Wilson', '246 Willow Way'),
(9, 3, 149.97, 'Mason Moore', '357 Redwood Circle'),
(10, 1, 24.99, 'Emma Taylor', '468 Aspen Avenue'),
(1, 5, 124.95, 'Oliver Anderson', '579 Beech Court'),
(2, 3, 149.97, 'Lucas Thomas', '681 Chestnut Lane'),
(3, 2, 99.98, 'Amelia Jackson', '792 Sycamore Place'),
(4, 1, 44.99, 'Elijah Harris', '124 Pinehurst Drive'),
(5, 4, 239.92, 'James Clark', '235 Evergreen Road'),
(6, 6, 239.94, 'Sophia White', '346 Magnolia Street'),
(7, 2, 79.98, 'William Lewis', '457 Cypress Terrace'),
(8, 5, 149.95, 'Benjamin Walker', '568 Juniper Boulevard'),
(9, 1, 49.99, 'Charlotte King', '679 Dogwood Court'),
(10, 3, 74.97, 'Henry Scott', '780 Alderwood Avenue'),
(1, 4, 199.96, 'Alexander Green', '891 Willowbend Drive'),
(2, 2, 99.98, 'Michael Adams', '123 Oakmont Lane'),
(3, 1, 49.99, 'Grace Turner', '234 Forest Hill Road'),
(4, 5, 224.95, 'Ava Baker', '345 Glenview Avenue'),
(5, 3, 179.97, 'Harper Allen', '456 Oakwood Street'),
(6, 4, 159.96, 'Jacob Perez', '567 Birchwood Court'),
(7, 1, 39.99, 'Isabella Sanchez', '678 Maplewood Drive'),
(8, 2, 59.98, 'Ethan Roberts', '789 Willow Creek Lane'),
(9, 6, 299.94, 'Lucas Thomas', '890 Cedar Grove Road'),
(10, 4, 99.96, 'Aiden Rivera', '901 Oakdale Avenue');
```

## How many shoes did we sell?

To find out how many shoes we sold and the total sale amount, we can do an aggregate over `paradedb.orders` joined to
`paradedb.bm25_search`:

```sql
    SELECT sum(order_quantity) AS quantity, sum(order_total) AS total_price
      FROM paradedb.orders
INNER JOIN paradedb.bm25_search products ON orders.product_id = products.id
     WHERE products.id @@@ 'description:shoes';
```

<Accordion title="Expected Response">
  ```csv quantity | total_price ----------+------------- 27 | 1299.69 (1 row)
  ```
</Accordion>

## Did Lucas Thomas buy a keyboard?

```sql
    SELECT *
      FROM paradedb.bm25_search products
INNER JOIN paradedb.orders ON orders.product_id = products.id
     WHERE products.id @@@ 'description:keyboard'
       AND orders.customer_name = 'Lucas Thomas';
```

Yes, yes he did!

<Accordion title="Expected Response">
```csv
 id |   description    | rating |  category   | in_stock |                 metadata                 |     created_at      | last_updated_date | latest_available>
----+------------------+--------+-------------+----------+------------------------------------------+---------------------+-------------------+----------------->
  2 | Plastic Keyboard |      4 | Electronics | f        | {"color": "Black", "location": "Canada"} | 2023-04-15 13:27:09 | 2023-04-16        | 13:27:09        >
(1 row)
```
</Accordion>

## Find unsold items

To find all the "black" items from the "United States" that haven't been purchased yet

```sql
    SELECT products.*
      FROM paradedb.orders
RIGHT JOIN paradedb.bm25_search products ON orders.product_id = products.id
     WHERE orders.product_id IS NULL
      AND products.id @@@ 'metadata.color:black'
      AND products.id @@@ 'metadata.location:"United States"';
```

<Accordion title="Expected Response">
```csv
 id |         description         | rating |  category   | in_stock |                    metadata                     |     created_at      | last_updated_date >
----+-----------------------------+--------+-------------+----------+-------------------------------------------------+---------------------+------------------->
 16 | High-resolution DSLR        |      4 | Photography | t        | {"color": "Black", "location": "United States"} | 2023-04-21 14:30:19 | 2023-04-23        >
 22 | Fast charging power bank    |      4 | Electronics | t        | {"color": "Black", "location": "United States"} | 2023-04-17 11:35:52 | 2023-04-19        >
(2 rows)
```
</Accordion>

## Summary

The above are simple fabricated examples of how to combine more sophisticated text search queries with JOINs using the
common concept of products and orders.

While real world data and queries will be different, ParadeDB is able to adapt to varying and complex query plans.
