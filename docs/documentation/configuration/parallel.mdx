---
title: Search Performance
---

As a general rule of thumb, the performance of expensive search queries can be greatly improved
if they are able to access more parallel Postgres workers and more shared buffer memory.

## Parallel Workers

The number of parallel workers depends on the server's CPU count and certain
Postgres settings in `postgresql.conf`.

`max_parallel_workers` and `max_worker_processes` control how many workers are available to parallel scans.
`max_worker_processes` is a global limit for the number of available workers across all connections, and
`max_parallel_workers` specifies how many of those workers can be used for parallel scans.

These settings must be changed inside `postgresql.conf`, and Postgres needs to be restarted afterward.

```init postgresql.conf
max_worker_processes = 16;
max_parallel_workers = 16;
```

Next, `max_parallel_workers_per_gather` must be set. This setting is a limit for the number of parallel workers that a single parallel query can use. The default is `2`.
This setting can be set in `postgresql.conf` to apply to all connections, or within a connection to apply to a single
session.

```sql
SET max_parallel_workers_per_gather = 16;
```

The number of parallel workers should not exceed the server's CPU count.

## Shared Buffers

`shared_buffers` controls how much memory is available to the Postgres buffer cache. While a general rule of thumb is to allocate up to 40% of total system memory to `shared_buffers`,
we recommend experimenting with higher values for larger indexes.

```sql postgresql.conf
shared_buffers = '8GB'
```

## Target Segment Count

Having too many or too few [segments](/documentation/concepts/index#segment) can negatively impact search performance.
`target_segment_count` controls the number of segments that should exist and defaults to the number of available CPUs
on the host machine.

This option can be specified at index creation time or changed afterward:

```sql
-- At index creation
CREATE INDEX search_idx ON mock_items
USING bm25 (id, description)
WITH (key_field='id', target_segment_count = 16);

-- Changed afterward
ALTER INDEX search_idx SET (target_segment_count = 16);
```

<Note>
  While ParadeDB attempts to create `target_segment_count` segments, the actual
  number of segments may not always equal `target_segment_count`. For instance,
  it could exceed this number if
  [`merge_on_insert`](/documentation/configuration/write#merge-on-insert) is
  disabled and `VACUUM` is not run, or fall below this number if the table
  contains a small number of rows.
</Note>
