version: "3"

services:
  core:
    extends:
      file: ../docker-compose.dev.yml
      service: core
    ports:
      - 9200:9200
      - 9600:9600

  api:
    extends:
      file: ../docker-compose.dev.yml
      service: api
    environment:
      OPENSEARCH_USE_TLS: False
      PGSYNC_SSL_ENABLED: False
    ports:
      - 8000:8000

  redis:
    extends:
      file: ../docker-compose.dev.yml
      service: redis

  pgsync:
    extends:
      file: ../docker-compose.dev.yml
      service: pgsync

  postgres:
    image: postgres:latest
    ports:
      - 5432:5432
    command: ["postgres", "-c", "max_replication_slots=10", "-c", "wal_level=logical", "-c", "max_wal_senders=5"]
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=postgres
    volumes:
      - ./create_tables.sql:/docker-entrypoint-initdb.d/create_tables.sql
      - ./fill_tables.sql:/docker-entrypoint-initdb.d/fill_tables.sql
